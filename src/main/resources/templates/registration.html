<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!--stílus hozzáadás-->
    <link rel="stylesheet" href="/css/style.css">
    <title>Registration</title>
</head>
<body>
<div id="header"></div>
<section class="login_form">
    <div class="topbar">
        <h2>Registration</h2>
    </div>
    <!--registration endpoint rákötése a formra-->
    <form th:action="@{/registration}" method="post" id="form">
        <div class="inputbox">
            <input type="text" name="name"  placeholder="Name"/>
        </div>
        <div class="inputbox">
            <input type="text" name="username" placeholder="Username"/>
        </div>
        <div class="inputbox">
            <input type="password" name="password" placeholder="Password"/>
        </div>
        <div class="inputbox">
            <input type="password" name="passwordcon" placeholder="Confirm password"/>
        </div>
        <div class="radiobox">
            <input type="radio" name="role" value="USER" />
            <label>User</label>
            <input type="radio" name="role" value="ACCOUNTANT" />
            <label>Accountant</label>
        </div>
        <button type="submit" id="submitbutton" disabled>Register</button>
        <!--link a login felületre-->
        <p class="registration"><a th:href="@{/login}">Log in</a></p>
    </form>
</section>
</body>
</html>
<script>
    const form = document.getElementById("form");
    const submitButton = document.getElementById("submitbutton");

    function validateForm() {
        // A formbeli mezők értékei
        const name = document.getElementsByName('name')[0].value.trim();
        const username = document.getElementsByName('username')[0].value.trim();
        const password = document.getElementsByName('password')[0].value;
        const confirmPassword = document.getElementsByName('passwordcon')[0].value;
        const selectedRole = document.querySelector('input[name="role"]:checked');

        // megnézzük ki vannak-e töltve a mezők és a jelszó megfelelő
        const allFilled = name && username && password && confirmPassword && selectedRole;
        const passwordsMatch = password === confirmPassword;
        const passwordValid = password.length >= 8;

        // Ha minden rendben, engedélyezzük a gombot
        submitButton.disabled = !(allFilled && passwordsMatch && passwordValid);
    }

    // Figyeljük a form mezőit
    form.addEventListener("input", validateForm);

    // Submit gomb figyelése
    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const data = {
            name: document.getElementsByName('name')[0].value.trim(),
            username: document.getElementsByName('username')[0].value.trim(),
            password: document.getElementsByName('password')[0].value,
            roles: [document.querySelector('input[name="role"]:checked').value]
        };

        // Adatok küldése a szervernek
        fetch('/registration', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            // Válasz kezelése
            if (response.status === 200) {
                alert('Successful registration!');
                window.location.href = "/login";
            } else if (response.status === 409) {
                alert('Username already taken.');
            } else {
                alert('Registration failed.');
            }
        });
    });
</script>

