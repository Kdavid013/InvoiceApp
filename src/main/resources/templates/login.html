    <!DOCTYPE html>
    <html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" th:href="@{css/style.css}">
        <title>Login</title>
    </head>
    <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
    <body>
    <div id="header"></div>
    <section class="login_form">
        <div class="topbar">
            <h2>Login</h2>
        </div>
        <!--login végpont bekötés-->
        <form th:action="@{/login}" method="post" id="form">
            <div class="inputbox">
                <input type="text" name="username" placeholder="Username" />
            </div>
            <div class="inputbox">
                <input type="password" name="password" placeholder="Password"/>
            </div>
            <div th:if="${captchaRequired == true}">
                <div class="g-recaptcha" data-sitekey="6Lchr9krAAAAACDaXx_bL0rKctkogHjRzRi5ITZt"></div>
            </div>
            <div th:if="${errorMessage != null}" class="error-message"  >
                <p th:text="${errorMessage}"></p>
            </div>
            <button type="submit" id="submitbutton" disabled>Log in</button>
            <!--link a regisztrációra-->
            <p class="registration"><a th:href="@{/registration}">Registration</a></p>
        </form>
    </section>
    </body>
    </html>
    <script>
        const form = document.getElementById("form");
        const submitButton = document.getElementById("submitbutton");
        const captchaDiv = document.querySelector(".g-recaptcha");

        // A logikát kiszerveztük a checkForm függvénybe
        const checkForm = () => {
            const username = document.getElementsByName("username")[0].value.trim();
            const password = document.getElementsByName("password")[0].value.trim();

            let captchaPassed = true;

            // Ha a CAPTCHA mező létezik a HTML-ben, ellenőrizni kell
            if (captchaDiv) {
                // Fontos: a grecaptcha.getResponse() csak a reCAPTCHA API betöltése után érhető el
                if (typeof grecaptcha !== 'undefined' && grecaptcha.getResponse) {
                    const response = grecaptcha.getResponse();
                    captchaPassed = response.length > 0;
                } else {
                    // Ha a CAPTCHA div van, de a grecaptcha még nem töltődött be/renderelve,
                    // ideiglenesen ne engedélyezzük a gombot
                    captchaPassed = false;
                }
            }

            if (username && password && captchaPassed) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        };

        form.addEventListener("input", checkForm);

        // EZ A FÜGGVÉNY FUT LE, MIUTÁN A GOOGLE API BETÖLTŐDÖTT
        window.onloadCallback = function() {
            if (captchaDiv) {
                 // 1. Manuális CAPTCHA renderelés (explicit mód)
                 grecaptcha.render(captchaDiv, {
                    'sitekey' : '6Lchr9krAAAAACDaXx_bL0rKctkogHjRzRi5ITZt', // Stringként megadva
                    'callback' : checkForm, // Sikeres pipálás után engedélyezi a gombot
                    'expired-callback' : checkForm // Lejárat esetén letiltja
                 });
            }

            // 2. Kezdeti ellenőrzés a DOM betöltése és a CAPTCHA inicializálása után
            // Ez engedélyezi a gombot, ha nincs CAPTCHA
            checkForm();
        };

        // Ezzel biztosítjuk, hogy ha nincs CAPTCHA (azaz a captchaDiv nem látható),
        // a gomb engedélyezve legyen, amint a felhasználó kitölti a mezőket.
        // (A checkForm már figyeli az input eseményeket.)
        // Ha a 'captchaRequired' false, a captchaDiv == null, a captchaPassed alapból 'true'.

    </script>

